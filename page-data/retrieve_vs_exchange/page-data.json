{"componentChunkName":"component---src-templates-post-template-tsx","path":"/retrieve_vs_exchange/","result":{"data":{"allMarkdownRemark":{"edges":[{"node":{"html":"<h1 id=\"retrieve-vs-exchange\" style=\"position:relative;\">retrieve vs exchange<a href=\"#retrieve-vs-exchange\" aria-label=\"retrieve vs exchange permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<hr>\n<h1 id=\"webclient에서-retrieve와-exchange는-어떻게-다를까\" style=\"position:relative;\">webclient에서 retrieve와 exchange는 어떻게 다를까<a href=\"#webclient%EC%97%90%EC%84%9C-retrieve%EC%99%80-exchange%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%8B%A4%EB%A5%BC%EA%B9%8C\" aria-label=\"webclient에서 retrieve와 exchange는 어떻게 다를까 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<blockquote>\n<p><code class=\"language-text\">exchange</code>는 현재 <em>deprecated</em> 되어 본문의 예제에서는 <code class=\"language-text\">exchangeToMono</code>를 사용합니다.</p>\n</blockquote>\n<p>공식문서에 따르면</p>\n<h2 id=\"retrieve\" style=\"position:relative;\">retrieve<a href=\"#retrieve\" aria-label=\"retrieve permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<blockquote>\n<p>Perform the HTTP request and retrieve the response body.</p>\n<p>…</p>\n<p>This method is a shortcut to using exchange() and decoding the response body through ClientResponse.</p>\n</blockquote>\n<h2 id=\"exchange\" style=\"position:relative;\">exchange<a href=\"#exchange\" aria-label=\"exchange permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<ul>\n<li><em>exchange는 현재 deprecated되었고 exchangeToMono와 exchangeToFlux 사용을 권장합니다.</em></li>\n</ul>\n<blockquote>\n<p>Perform the HTTP request and return a ClientResponse with the response status and headers. You can then use methods of the response to consume the body:</p>\n</blockquote>\n<p><code class=\"language-text\">retrieve</code>는 <code class=\"language-text\">ClientResponse</code>를 통해 응답 바디를 디코딩한 <code class=\"language-text\">exchange</code>의 숏컷이며,</p>\n<p><code class=\"language-text\">exchange</code>는 상태코드와 헤더와 함께 <code class=\"language-text\">ClientResponse</code>를 반환합니다.</p>\n<p>제가 이해한대로 풀어보자면 <code class=\"language-text\">retrieve</code>는 응답 바디를 바로 받아볼 수 있는 <code class=\"language-text\">exchange</code>의 편의 메소드이며 <code class=\"language-text\">exchange</code>는 응답 바디뿐만 아니라 헤더와 상태코드까지 받아볼 수 있는 메서드라는 것인데</p>\n<p>그렇다면 <code class=\"language-text\">retrieve</code> 에서는 헤더와 상태코드를 받아볼 수 없는 것일까요</p>\n<p>테스트를 위해 간단한 컨트롤러를 만들었습니다.</p>\n<h1 id=\"테스트\" style=\"position:relative;\">테스트<a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8\" aria-label=\"테스트 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<p>아래는 version이라는 쿼리스트링을 받으며 이 값에 따라 상태코드와 응답바디를 다르게 리턴하는 엔드포인트입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// 쿼리의 version값에 따라 다른 응답코드와 바디를 리턴하는 엔드포인트</span>\n<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/return\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token operator\">?</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">returnData</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> version<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">></span></span> queryString <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    queryString<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"page\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"123\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    queryString<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"size\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1231\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    queryString<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"size\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"1231\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Map</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">,</span> <span class=\"token class-name\">String</span> <span class=\"token punctuation\">></span></span> credential <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HashMap</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    credential<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"aaaa\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"aaaaa\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    credential<span class=\"token punctuation\">.</span><span class=\"token function\">put</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"bbbb\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"bbbbb\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">HttpHeaders</span> headers <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">HttpHeaders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    headers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"AAAAAAAA\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"fklsdnafg7i234gyuisv684\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    headers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"BBBBBBBB\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"gv3jkigh98vwb0\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    headers<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"CCCCCCCC\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"0000000000090000000\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">switch</span> <span class=\"token punctuation\">(</span>version<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">headers</span><span class=\"token punctuation\">(</span>headers<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span>credential<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">300</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">headers</span><span class=\"token punctuation\">(</span>headers<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span>credential<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">400</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">headers</span><span class=\"token punctuation\">(</span>headers<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span>queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">headers</span><span class=\"token punctuation\">(</span>headers<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gnio4hwg8902349030kzmamamavjih890w44gkuzd\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">default</span><span class=\"token operator\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token class-name\">ResponseEntity</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">status</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">headers</span><span class=\"token punctuation\">(</span>headers<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">body</span><span class=\"token punctuation\">(</span>queryString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre></div>\n<h2 id=\"retrieve-1\" style=\"position:relative;\">Retrieve<a href=\"#retrieve-1\" aria-label=\"retrieve 1 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>같은 컨트롤러에 다른 엔드포인트를 하나 더 만들어 /return으로 요청하여 값을 검증해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/testRetrieve\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">testRetrieve</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> version<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">ResponseEntity</span><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span><span class=\"token punctuation\">></span></span> objectMono <span class=\"token operator\">=</span> <span class=\"token class-name\">WebClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:8090\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/return?version=\"</span> <span class=\"token operator\">+</span> version<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">retrieve</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">toEntity</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">ResponseEntity</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> response <span class=\"token operator\">=</span> objectMono<span class=\"token punctuation\">.</span><span class=\"token function\">block</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"version : \"</span> <span class=\"token operator\">+</span> version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response.getHeaders() = \"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getHeaders</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response.getStatusCodeValue() = \"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getStatusCodeValue</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response.hasBody() = \"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">hasBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response.getBody() = \"</span> <span class=\"token operator\">+</span> response<span class=\"token punctuation\">.</span><span class=\"token function\">getBody</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"test Ok\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><img src=\"%7B%7Bsite.url%7D%7D/assets/images/jmb/retrieve_exchange/img1.png\" alt=\"img1\"></p>\n<p>정상적으로 값을 받아오는걸 볼 수 있습니다.</p>\n<p>400과 500은 Bad Request와 Internal Server Error로 Webclient가 오류를 띄워주네요.</p>\n<p><code class=\"language-text\">retrieve</code> 에서도 정상적으로 상태코드와 헤더를 받아볼 수 있었습니다.</p>\n<p>그렇다면<code class=\"language-text\">retrieve</code> 에서도 상태코드, 헤더와 같은 정보를 받아올 수 있는데 <code class=\"language-text\">exchange</code> 와는 어떤 점이 다른걸까 더 불분명해진 상황이었습니다.</p>\n<p>자료를 더 찾아본 결과 <code class=\"language-text\">exchange</code>는 응답에 따른 유연한 상태처리가 가능하다는 것이었는데요</p>\n<p>하지만 응답에 따른 상태처리는 <code class=\"language-text\">retrieve</code> 도 <code class=\"language-text\">onStatus</code> 함수로 처리할 수 있습니다.</p>\n<p><code class=\"language-text\">onStatus</code>의 인터페이스를 확인해보면 매개변수로 Throwable을 상속받은 객체를 Mono로 감싸 넘겨줄 수 있습니다.</p>\n<p><img src=\"%7B%7Bsite.url%7D%7D/assets/images/jmb/retrieve_exchange/img2.png\" alt=\"img2\"></p>\n<h2 id=\"exchange-1\" style=\"position:relative;\">Exchange<a href=\"#exchange-1\" aria-label=\"exchange 1 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>그러면 <code class=\"language-text\">exchange</code> 는 어떤지 살펴보았습니다.</p>\n<p>똑같이 /return으로 요청을 보내고 처리만 <code class=\"language-text\">exchange</code>로 진행하였습니다.</p>\n<p>이번에는 <code class=\"language-text\">exchangeToMono</code>의 인터페이스 먼저 살펴본 후 넘어가겠습니다.</p>\n<p><img src=\"%7B%7Bsite.url%7D%7D/assets/images/jmb/retrieve_exchange/img3.png\" alt=\"img3\"></p>\n<p>Throwable을 상속받은 객체만 Mono형태로 리턴할 수 있는 <code class=\"language-text\">onStatus</code>와 달리 Mono를 상속받은 아무 객체나 리턴시킬 수 있습니다.</p>\n<p>이제 테스트를 진행해보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// /return에 요청을 보내 상태코드에 따라 응답 값을 처리하는 엔드포인트</span>\n<span class=\"token annotation punctuation\">@GetMapping</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/testExchange\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token class-name\">String</span> <span class=\"token function\">testExchange</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@RequestParam</span><span class=\"token punctuation\">(</span>required <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">int</span> version<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token class-name\">Mono</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">></span></span> objectMono <span class=\"token operator\">=</span> <span class=\"token class-name\">WebClient</span><span class=\"token punctuation\">.</span><span class=\"token function\">create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"http://localhost:8090\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">uri</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/return?version=\"</span> <span class=\"token operator\">+</span> version<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">.</span><span class=\"token function\">exchangeToMono</span><span class=\"token punctuation\">(</span>res <span class=\"token operator\">-></span> <span class=\"token punctuation\">{</span>\n\t\t\t\t\t\t<span class=\"token comment\">// 헤더를 통한 컨트롤 또한 가능하다.</span>\n\t\t\t\t\t\t<span class=\"token comment\">// HttpHeaders httpHeaders = res.headers().asHttpHeaders();</span>\n            <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span><span class=\"token function\">statusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">bodyToMono</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">MULTIPLE_CHOICES</span><span class=\"token punctuation\">.</span><span class=\"token function\">equals</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">.</span><span class=\"token function\">statusCode</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> <span class=\"token class-name\">Mono</span><span class=\"token punctuation\">.</span><span class=\"token function\">empty</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">return</span> res<span class=\"token punctuation\">.</span><span class=\"token function\">createException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Mono</span><span class=\"token operator\">::</span><span class=\"token function\">error</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"version : \"</span> <span class=\"token operator\">+</span> version<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>objectMono<span class=\"token punctuation\">.</span><span class=\"token function\">hasElement</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">block</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"objectMono NULL\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token keyword\">else</span><span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">System</span><span class=\"token punctuation\">.</span>out<span class=\"token punctuation\">.</span><span class=\"token function\">println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"objectMono.block().toString() = \"</span> <span class=\"token operator\">+</span> objectMono<span class=\"token punctuation\">.</span><span class=\"token function\">block</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token string\">\"test Ok\"</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><img src=\"%7B%7Bsite.url%7D%7D/assets/images/jmb/retrieve_exchange/img4.png\" alt=\"img4\"></p>\n<p>오류의 형태로만 컨트롤할 수 있던 <code class=\"language-text\">retrieve</code> 와 달리 <code class=\"language-text\">exchange</code> 는 리턴 값의 형태를 바꾸거나 오류로 치환하는 등의 더 유연한 처리가 가능했습니다.</p>\n<h1 id=\"마무리\" style=\"position:relative;\">마무리<a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"custom-class after\"><svg aria-hidden=\"true\" height=\"20\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"20\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h1>\n<ol>\n<li><code class=\"language-text\">retrieve</code>는 <code class=\"language-text\">exchange</code> 를 이용한 편의 메서드이다.</li>\n<li><code class=\"language-text\">retrieve</code> 에서도 충분히 상태코드와 헤더를 받아볼 수 있다.</li>\n<li><code class=\"language-text\">retrieve</code> 에서도 <code class=\"language-text\">onStatus</code>를 이용하여 상태코드에 따른 에러처리를 할 수  있으나 에러의 형태로만 처리가 가능하다.</li>\n<li><code class=\"language-text\">exchange</code>는 상태코드 뿐만 아니라 헤더를 통한 처리 등 <code class=\"language-text\">retrieve</code> 보다 훨씬 유연한 처리가 가능하다.</li>\n</ol>\n<p>결과적으로 간단한 처리만 하는 경우에는 <code class=\"language-text\">retrieve</code></p>\n<p>응답 상태 및 결과에 따른 에러발생, 데이터 변경 등 다양한 처리가 필요하다면 <code class=\"language-text\">exchange</code> 를 사용</p>\n<p>추가적으로 Mono나 Flux의 메소드 중 do…, on… 의 여러 메소드들이 존재하여 에러 발생 시 특정 값이 넘기거나 에러를 스킵하고 동작, 성공 시 처리, 종료 시 처리 등의 또 다른 처리들이 가능하지만 아직은 공부가 부족하여 좀 더 공부한 후에 다뤄보는것이 보고싶습니다.</p>\n<p>내용에 틀리거나 지적할 부분이 있을 시 알려주신다면 감사하겠습니다.</p>\n<blockquote>\n<p>참조: <a href=\"https://stackoverflow.com/questions/58410352/spring-boot-webclients-retrieve-vs-exchange\" target=\"_blank\" rel=\"nofollow\">https://stackoverflow.com/questions/58410352/spring-boot-webclients-retrieve-vs-exchange</a></p>\n</blockquote>","tableOfContents":"<ul>\n<li>\n<p><a href=\"#retrieve-vs-exchange\">retrieve vs exchange</a></p>\n</li>\n<li>\n<p><a href=\"#webclient%EC%97%90%EC%84%9C-retrieve%EC%99%80-exchange%EB%8A%94-%EC%96%B4%EB%96%BB%EA%B2%8C-%EB%8B%A4%EB%A5%BC%EA%B9%8C\">webclient에서 retrieve와 exchange는 어떻게 다를까</a></p>\n<ul>\n<li><a href=\"#retrieve\">retrieve</a></li>\n<li><a href=\"#exchange\">exchange</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%ED%85%8C%EC%8A%A4%ED%8A%B8\">테스트</a></p>\n<ul>\n<li><a href=\"#retrieve-1\">Retrieve</a></li>\n<li><a href=\"#exchange-1\">Exchange</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></p>\n</li>\n</ul>","frontmatter":{"title":"Webclient에서 retrieve와 exchange의 차이점","summary":"retrieve와 exchange의 차이점과 테스트","date":"2022.08.10.","categories":["Spring"],"thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAADTUlEQVQozx2P2zfbBwCAf3/LztnO6bq1Dz1ns0ndh9Rc65KFXCQipAhyQe4UmbmclCalhuVUFIsjJMFGtEYRK2XEZe16erY97L/4dtqH7+V7+c4nHM4ZePWziVcLZo6CJo4X2zhbsnC+ZOEqYv/Am1Unr1ddvFmz8fZXB2/XbPyz6eLd+ntv42rVxUXUyWXUiRB/aiT+1MDBrIGX80b254z8EbJwtthBYtnKRcTGRdj2IbA7b2U31M9eZJiDFS/7YQ/7i72cLNu5XHVwHrEjHMwYiU02MjtYzW6ghehoPfszBk4XLZyGOkiErFyFLcQmWni5u8bVeZzEyQ6H8Rh72yvE92JsL3lIvL8K2xG2/XpeBAyEvbXMD6mIPKojHjByPNfG0ayZXX8rR7MGAv06Tk92ePFbmOjSE+Znxph8PMDm+iKHG1McB81cRh0IW1ONPPvxHuGHWpa9WsacEvw9MiY6q5jokuN31zDulGLTFXF18Tt//XnIs40QO1tRjg5i/PfvJbGFEeLTTSSWbAgrPi3hB2omO6UE+uSMdJTQ8F0aQzYFXpeSie/riE61020oZdY/zN/vzthYC7K3Feb52gzheR/PA1ZOgibOQhaEgLuKyIiG9UcaNh5rMSozqC76ihZFFiXpN8j64mPEouuoSkQ86DPR3ixHXSpisEPC+H0p0bE6zqMOEmEr8TkTwopXRWxcw8a4DldjOd+m3aKntQxFcQq5ydcQp9wkO/kGqbc+YbyvHp0kFY9Vxumynde/ODiNONh8YmK0swazthJhtNfEcJcNtaKZzG+kZCR9hs8pw9FQyN3cJDSKcuQVeYhufkTA04iuUkyOuIZmXTujP3TT365BUpBLaWkxNWoZQkeLEnt3kCb9IDUKLZlffspDexVjXXLkBUlICtMoy08nL+VzfhrUoSq/g1FvR63tQ1XnplZRjDg7GY3kNm5jPoJGUYhSWo/TbMZzX4+0OIuC29fwuZRMD9ahLkoiT3SdekkaOmkmboeeoN9DrVJHTlYumZlf01Cdg2dARa9bi5CTnkGjshxfv4WBzlaa1Xdo0pYhKxGhl6cy1K1FUZFNZX4y91Ql+AbsLEx76bG3oZLkYa/PQFOVg0xTRUHFXf4HxKxqL6EXfrIAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/static/5fb235b812b70bffacbd78de994d9585/1115f/test.png","srcSet":"/static/5fb235b812b70bffacbd78de994d9585/ac032/test.png 118w,\n/static/5fb235b812b70bffacbd78de994d9585/17927/test.png 235w,\n/static/5fb235b812b70bffacbd78de994d9585/1115f/test.png 470w","sizes":"(min-width: 470px) 470px, 100vw"},"sources":[{"srcSet":"/static/5fb235b812b70bffacbd78de994d9585/f421b/test.webp 118w,\n/static/5fb235b812b70bffacbd78de994d9585/42a7d/test.webp 235w,\n/static/5fb235b812b70bffacbd78de994d9585/758aa/test.webp 470w","type":"image/webp","sizes":"(min-width: 470px) 470px, 100vw"}]},"width":470,"height":272}},"publicURL":"/static/5fb235b812b70bffacbd78de994d9585/test.png"}}}}]}},"pageContext":{"slug":"/retrieve_vs_exchange/"}},"staticQueryHashes":[]}